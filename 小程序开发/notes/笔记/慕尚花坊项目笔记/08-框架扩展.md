### 01. mobx-miniprogram



#### 1.1 mobx-miniprogram ä»‹ç»



ç›®å‰å·²ç»å­¦ä¹ äº† 6 ç§å°ç¨‹åºé¡µé¢ã€ç»„ä»¶é—´çš„æ•°æ®é€šä¿¡æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ï¼š



1. æ•°æ®ç»‘å®šï¼š`properties`
2. è·å–ç»„ä»¶å®ä¾‹ï¼š`this.selectComponent()`
3. äº‹ä»¶ç»‘å®šï¼š`this.triggerEvent()`
4. è·å–åº”ç”¨å®ä¾‹ï¼š`getApp()`
5. é¡µé¢é—´é€šä¿¡ï¼š`EventChannel`
6. äº‹ä»¶æ€»çº¿ï¼š`pubsub-js`



åœ¨ä¸­å°å‹é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿™äº›æ•°æ®é€šä¿¡æ–¹å¼å·²ç»èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬é¡¹ç›®çš„éœ€æ±‚ã€‚

ä½†æ˜¯éšç€é¡¹ç›®çš„ä¸šåŠ¡é€»è¾‘è¶Šæ¥è¶Šå¤æ‚ï¼Œç»„ä»¶å’Œé¡µé¢é—´é€šä¿¡å°±ä¼šå˜çš„éå¸¸å¤æ‚ã€‚ä¾‹å¦‚ï¼šæœ‰äº›çŠ¶æ€éœ€è¦åœ¨å¤šä¸ªé¡µé¢é—´è¿›è¡ŒåŒæ­¥ä½¿ç”¨ï¼Œä¸€ä¸ªåœ°æ–¹å‘ç”Ÿå˜æ›´ï¼Œæ‰€æœ‰ä½¿ç”¨çš„åœ°æ–¹éƒ½éœ€è¦å‘ç”Ÿæ”¹å˜ï¼Œè¿™æ—¶å€™å¦‚æœä½¿ç”¨å‰é¢çš„æ•°æ®é€šä¿¡æ–¹æ¡ˆè¿›è¡Œä¼ é€’æ•°æ®ï¼Œç»™ç®¡ç†å’Œç»´æŠ¤å°†å­˜åœ¨å¾ˆå¤§çš„é—®é¢˜ã€‚



ä¸ºäº†æ–¹ä¾¿è¿›è¡Œé¡µé¢ã€ç»„ä»¶ä¹‹é—´æ•°æ®çš„ä¼ é€’ï¼Œå°ç¨‹åºå®˜æ–¹æä¾›äº†ä¸€ä¸ªæ‰©å±•å·¥å…·åº“ï¼š `mobx-miniprogram`



`mobx-miniprogram` æ˜¯é’ˆå¯¹å¾®ä¿¡å°ç¨‹åºå¼€å‘çš„ä¸€ä¸ªç®€å•ã€é«˜æ•ˆã€è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒåŸºäº`Mobx`çŠ¶æ€ç®¡ç†æ¡†æ¶å®ç°ã€‚

ä½¿ç”¨ `mobx-miniprogram` å®šä¹‰ç®¡ç†çš„çŠ¶æ€æ˜¯å“åº”å¼çš„ï¼Œå½“çŠ¶æ€ä¸€æ—¦å®ƒæ”¹å˜ï¼Œæ‰€æœ‰å…³è”ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ç›¸å¯¹åº”çš„æ•°æ®

é€šè¿‡è¯¥æ‰©å±•å·¥å…·åº“ï¼Œå¼€å‘è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨å°ç¨‹åºä¸­å…¨å±€å…±äº«çš„çŠ¶æ€ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°è§†å›¾ç»„ä»¶ï¼Œä»è€Œæå‡å°ç¨‹åºçš„å¼€å‘æ•ˆç‡



éœ€è¦æ³¨æ„ï¼šåœ¨ä½¿ç”¨ `mobx-miniprogram` éœ€è¦å®‰è£…ä¸¤ä¸ªåŒ…ï¼š`mobx-miniprogram` å’Œ `mobx-miniprogram-bindings`

1.  `mobx-miniprogram` çš„ä½œç”¨ï¼šåˆ›å»º `Store` å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨åº”ç”¨çš„æ•°æ®
2.  `mobx-miniprogram-bindings` çš„ä½œç”¨ï¼šå°†çŠ¶æ€å’Œç»„ä»¶ã€é¡µé¢è¿›è¡Œç»‘å®šå…³è”ï¼Œä»è€Œåœ¨ç»„ä»¶å’Œé¡µé¢ä¸­æ“ä½œæ•°æ®



```shell
npm install mobx-miniprogram mobx-miniprogram-bindings
```



å®˜æ–¹æ–‡æ¡£ï¼š

1. [mobx-miniprogram å®˜æ–¹æ–‡æ¡£](https://www.npmjs.com/package/mobx-miniprogram)

2. [mobx-miniprogram-bindings å®˜æ–¹æ–‡æ¡£](https://www.npmjs.com/package/mobx-miniprogram-bindings)







#### 1.2 åˆ›å»º Store å¯¹è±¡



å¦‚æœéœ€è¦åˆ›å»º Store å¯¹è±¡éœ€è¦ä½¿ç”¨ `mobx-miniprogram` ï¼Œå› æ­¤éœ€è¦å…ˆç†Ÿæ‚‰ `mobx-miniprogram` ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ:



1. `observable`ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªè¢«ç›‘æµ‹çš„å¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§å°±æ˜¯åº”ç”¨çš„çŠ¶æ€(state)ï¼Œè¿™äº›çŠ¶æ€ä¼šè¢«è½¬æ¢æˆå“åº”å¼æ•°æ®ã€‚
2. `action`ï¼šç”¨äºä¿®æ”¹çŠ¶æ€(state)çš„æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨ action å‡½æ•°æ˜¾å¼çš„å£°æ˜åˆ›å»ºã€‚
3. `computed`ï¼šæ ¹æ®å·²æœ‰çŠ¶æ€(state)ç”Ÿæˆçš„æ–°å€¼ã€‚è®¡ç®—å±æ€§æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•å‰é¢å¿…é¡»åŠ ä¸Š `get` ä¿®é¥°ç¬¦

 

`mobx-miniprogram` è¯¦ç»†çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š



1. åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º `store` æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»º `index.js` 

2. åœ¨ `/store/index.js` å¯¼å…¥ `observable ` ã€`action` æ–¹æ³•

   ```js
   import { observable, action } from 'mobx-miniprogram'
   ```

   

3. ä½¿ç”¨ `observable ` æ–¹æ³•éœ€è¦æ¥å—ä¸€ä¸ª `store` å¯¹è±¡ï¼Œå­˜å‚¨åº”ç”¨çš„çŠ¶æ€

   ```js
   // observableï¼šç”¨äºåˆ›å»ºä¸€ä¸ªè¢«ç›‘æµ‹çš„å¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§å°±æ˜¯åº”ç”¨çš„çŠ¶æ€(state)ï¼Œè¿™äº›çŠ¶æ€ä¼šè¢«è½¬æ¢æˆå“åº”å¼æ•°æ®ã€‚
   // actionï¼šç”¨äºæ˜¾å¼çš„å£°æ˜åˆ›å»ºæ›´æ–° state çŠ¶æ€çš„æ–¹æ³•
   import { observable, action } from 'mobx-miniprogram'
   
   // ä½¿ç”¨ observable åˆ›å»ºä¸€ä¸ªè¢«ç›‘æµ‹çš„å¯¹è±¡
   export const numStore = observable({
   
     // åˆ›å»ºåº”ç”¨çŠ¶æ€
     numA: 1,
     numB: 2,
       
     // ä½¿ç”¨ action æ›´æ–° numA ä»¥åŠ numB
     update: action(function () {
       this.numA+=1
       this.numB+=1
     }),
   
     // è®¡ç®—å±æ€§ï¼Œä½¿ç”¨ get ä¿®é¥°ç¬¦ï¼Œ
     get sum() {
       return this.numA + this.numB;
     }
   
   })
   
   ```

   







#### 1.3 åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ•°æ®



å¦‚æœéœ€è¦ `Page` æˆ–è€…`Component`ä¸­å¯¹å…±äº«çš„æ•°æ®è¿›è¡Œè¯»å–ã€æ›´æ–°æ“ä½œï¼Œéœ€è¦ä½¿ç”¨ `mobx-miniprogram-bindings`

`mobx-miniprogram-bindings` çš„ä½œç”¨å°±æ˜¯å°† `Store` å’Œ é¡µé¢æˆ–ç»„ä»¶è¿›è¡Œç»‘å®šå…³è”



å¦‚æœéœ€è¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€ï¼Œéœ€è¦ `mobx-miniprogram-bindings` åº“ä¸­å¯¼å…¥ `ComponentWithStore` æ–¹æ³•

åœ¨ä½¿ç”¨æ—¶ï¼š**<font color="red">éœ€è¦å°† `Component` æ–¹æ³•æ›¿æ¢æˆ `ComponentWithStore` æ–¹æ³• </font>**ï¼ŒåŸæœ¬ç»„ä»¶é…ç½®é¡¹ä¹Ÿéœ€è¦å†™åˆ°è¯¥æ–¹æ³•ä¸­



åœ¨æ›¿æ¢ä»¥åï¼Œå°±ä¼šæ–°å¢ä¸€ä¸ª `storeBindings` é…ç½®é¡¹ï¼Œé…ç½®é¡¹å¸¸ç”¨çš„å±æ€§æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š

1. `store`: æŒ‡å®šè¦ç»‘å®šçš„ `Store` å¯¹è±¡
2. `fields`: æŒ‡å®šéœ€è¦ç»‘å®šçš„ `data` å­—æ®µ
3. `actions`: æŒ‡å®šéœ€è¦æ˜ å°„çš„ `actions` æ–¹æ³•



> ğŸ“Œ **æ³¨æ„äº‹é¡¹ï¼š**
>
>    **å¯¼å…¥çš„æ•°æ®ä¼šåŒæ­¥åˆ°ç»„ä»¶çš„ data ä¸­**
>
>    **å¯¼å…¥çš„æ–¹æ³•ä¼šåŒæ­¥åˆ°ç»„ä»¶çš„ methods ä¸­**



```js
// components/custom01/custom01.js
import { ComponentWithStore } from 'mobx-miniprogram-bindings'
import { numStore } from '../../stores/numstore'

ComponentWithStore({
  data: {
    someData: '...'
  },
  storeBindings: {
    store: numStore,
    fields: ['numA', 'numB', 'sum'],
    actions: ['update']
  }
})

```









#### 1.4 åœ¨é¡µé¢ä¸­ä½¿ç”¨æ•°æ®-æ–¹å¼1



Component æ–¹æ³•ç”¨äºåˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶ã€‚

å°ç¨‹åºçš„é¡µé¢ä¹Ÿå¯ä»¥è§†ä¸ºè‡ªå®šä¹‰ç»„ä»¶ï¼Œå› æ­¤é¡µé¢ä¹Ÿå¯ä»¥ä½¿ç”¨ Component æ–¹æ³•è¿›è¡Œæ„å»ºï¼Œä»è€Œå®ç°å¤æ‚çš„é¡µé¢é€»è¾‘å¼€å‘ã€‚



å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† Component æ–¹æ³•æ¥æ„å»ºé¡µé¢ï¼Œé‚£ä¹ˆé¡µé¢ä¸­å¦‚æœæƒ³ä½¿ç”¨ `Store` ä¸­çš„æ•°æ®ï¼Œä½¿ç”¨æ–¹å¼å’Œç»„ä»¶çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸€æ ·çš„



1. ä» `mobx-miniprogram-bindings` åº“ä¸­å¯¼å…¥ `ComponentWithStore` æ–¹æ³•
2. å°† `Component` æ–¹æ³•æ›¿æ¢æˆ `ComponentWithStore` æ–¹æ³•
3. ç„¶åé…ç½® `storeBindings` ä» `Store` ä¸­æ˜ å°„æ•°æ®å’Œæ–¹æ³•å³å¯



```js
// index/index.js
import { ComponentWithStore } from 'mobx-miniprogram-bindings'
import { numStore } from '../../stores/numstore'

ComponentWithStore({
  data: {
    someData: '...'
  },
  storeBindings: {
    store: numStore,
    fields: ['numA', 'numB', 'sum'],
    actions: ['update']
  }
})

```









#### 1.5 åœ¨é¡µé¢ä¸­ä½¿ç”¨æ•°æ®-æ–¹å¼2



åœ¨ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Component æ–¹æ³•æ„å»ºé¡µé¢ï¼Œç„¶åä½¿ç”¨ `ComponentWithStore` æ–¹æ³•è®©é¡µé¢å’Œ `Store` å»ºç«‹äº†å…³è”



å¦‚æœä¸æƒ³ä½¿ç”¨ Component æ–¹æ³•æ„å»ºé¡µé¢ã€‚è¿™æ—¶å€™éœ€è¦ä½¿ç”¨ `mobx-miniprogram-bindings` æä¾›çš„ `BehaviorWithStore` æ–¹æ³•æ¥å’Œ `Store` å»ºç«‹å…³è”ã€‚



å°ç¨‹åºçš„ behavior æ–¹æ³•æ˜¯ä¸€ç§ä»£ç å¤ç”¨çš„æ–¹å¼ï¼Œå¯ä»¥å°†ä¸€äº›é€šç”¨çš„é€»è¾‘å’Œæ–¹æ³•æå–å‡ºæ¥ï¼Œç„¶ååœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨ï¼Œä»è€Œå‡å°‘ä»£ç å†—ä½™ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚**<font color="red">åœ¨é¡µé¢ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ `behaviors` é…ç½®é¡¹</font>**



ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1. æ–°å»º `behavior` æ–‡ä»¶ï¼Œä» `mobx-miniprogram-bindings` åº“ä¸­å¯¼å…¥ `BehaviorWithStore` æ–¹æ³•
2. åœ¨ `BehaviorWithStore` æ–¹æ³•ä¸­é…ç½® `storeBindings` é…ç½®é¡¹ä» `Store` ä¸­æ˜ å°„æ•°æ®å’Œæ–¹æ³•
3. åœ¨ `Page` æ–¹æ³•ä¸­å¯¼å…¥åˆ›å»ºçš„ `behavior` ï¼Œç„¶åé…ç½® `behavior` å±æ€§ï¼Œå¹¶ä½¿ç”¨å¯¼å…¥çš„ `behavior`



```js
// behavior.js

import { BehaviorWithStore } from 'mobx-miniprogram-bindings'
import { numStore } from '../../stores/numstore'

export const indexBehavior = BehaviorWithStore({
  storeBindings: {
    store: numStore,
    fields: ['numA', 'numB', 'sum'],
    actions: ['update'],
  }
})

```

```js
// index.js

import { indexBehavior } from './behavior'

Page({
  behaviors: [indexBehavior]
    
  // å…¶ä»–é…ç½®é¡¹
})

```









#### 1.6 fieldsã€actions å¯¹è±¡å†™æ³•



`fields`ã€`actions` æœ‰ä¸¤ç§å†™æ³•ï¼šæ•°ç»„ æˆ–è€… å¯¹è±¡ã€‚



å¦‚æœ `fields` å†™æˆå¯¹è±¡æ–¹å¼ï¼Œæœ‰ä¸¤ç§å†™æ³•ï¼š



1. æ˜ å°„å½¢å¼ï¼šæŒ‡å®š data ä¸­å“ªäº›å­—æ®µæ¥æºäº `store` ä»¥åŠå®ƒä»¬åœ¨ `store` ä¸­å¯¹åº”çš„åå­—ã€‚
   - ä¾‹å¦‚ `{ a: 'numA', b: 'numB' }`

2. å‡½æ•°å½¢å¼ï¼šæŒ‡å®š data ä¸­æ¯ä¸ªå­—æ®µçš„è®¡ç®—æ–¹æ³•
   - ä¾‹å¦‚ `{ a: () => store.numA, b: () => anotherStore.numB }` 



å¦‚æœ `actions` å†™æˆå¯¹è±¡æ–¹å¼ï¼Œåªæœ‰ä¸¤ç§å†™æ³•ï¼š

1. æ˜ å°„å½¢å¼ï¼šæŒ‡å®šæ¨¡æ¿ä¸­è°ƒç”¨çš„å“ªäº›æ–¹æ³•æ¥æºäº `store` ä»¥åŠå®ƒä»¬åœ¨ `store` ä¸­å¯¹åº”çš„åå­—ã€‚
   - ä¾‹å¦‚ `{ buttonTap: 'update' }` 



```js
import { ComponentWithStore } from 'mobx-miniprogram-bindings'
import { numStore } from '../../stores/numstore'

ComponentWithStore({
  data: {
    someData: '...'
  },
  storeBindings: {
    store: numStore,
    fields: {
      // ä½¿ç”¨å‡½æ•°æ–¹å¼è·å– Store ä¸­çš„æ•°æ®
      a: () => store.numA,
      b: () => store.numB,

      // ä½¿ç”¨æ˜ å°„å½¢å¼è·å– Store ä¸­çš„æ•°æ®ï¼Œå€¼ä¸ºæ•°æ®åœ¨ store ä¸­å¯¹åº”çš„åå­—
      total: 'sub'
    },

    // ä½¿ç”¨æ˜ å°„å½¢å¼è·å– Store ä¸­çš„ action åå­—
    actions: {
      // key è‡ªå®šä¹‰ï¼Œä¸ºå½“å‰ç»„ä»¶ä¸­è°ƒç”¨çš„æ–¹æ³•
      // å€¼ä¸º store ä¸­å¯¹åº”çš„ action åå­—
      buttonTap: 'update'
    }
  }
})

```







#### 1.7 ç»‘å®šå¤šä¸ª store ä»¥åŠå‘½åç©ºé—´



åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ªé¡µé¢æˆ–è€…ç»„ä»¶å¯èƒ½ä¼šç»‘å®šå¤šä¸ª `Store` ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å°† `storeBindings` æ”¹é€ æˆæ•°ç»„ã€‚æ•°ç»„æ¯ä¸€é¡¹å°±æ˜¯ä¸€ä¸ªä¸ªè¦ç»‘å®šçš„ `Store`ã€‚



å¦‚æœå¤šä¸ª `Store` ä¸­å­˜åœ¨ç›¸åŒçš„æ•°æ®ï¼Œæ˜¾ç¤ºä¼šå‡ºç°å¼‚å¸¸ã€‚è¿˜å¯ä»¥é€šè¿‡ `namespace` å±æ€§ç»™å½“å‰ `Store` å¼€å¯å‘½åç©ºé—´ï¼Œåœ¨å¼€å¯å‘½åç©ºé—´ä»¥åï¼Œè®¿é—®æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦åŠ ä¸Š `namespace ` çš„åå­—æ‰å¯ä»¥ã€‚



```js
// behavior.js

import { BehaviorWithStore } from 'mobx-miniprogram-bindings'
import { numStore } from '../../stores/numstore'

export const indexBehavior = BehaviorWithStore({
  storeBindings: [
    {
      namespace: 'numStore',
      store: numStore,
      fields: ['numA', 'numB', 'sum'],
      actions: ['update'],
    }
  ]
})

```

```html
// index/index.wxml

<view>{{ numStore.numA }} + {{ numStore.numB }} = {{numStore.sum}}</view>

```











### 02. miniprogram-computed



å°ç¨‹åºæ¡†æ¶æ²¡æœ‰æä¾›è®¡ç®—å±æ€§ç›¸å…³çš„ api ï¼Œä½†æ˜¯å®˜æ–¹ä¸ºå¼€å‘è€…æä¾›äº†æ‹“å±•å·¥å…·åº“ [miniprogram-computed](https://www.npmjs.com/package/miniprogram-computed)ã€‚



è¯¥å·¥å…·åº“æä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š

1. è®¡ç®—å±æ€§ `computed`
2. ç›‘å¬å™¨ `watch` 



#### 2.1 è®¡ç®—å±æ€§ `computed`



**çŸ¥è¯†ç‚¹ï¼š**



å¦‚æœéœ€è¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è®¡ç®—å±æ€§åŠŸèƒ½ï¼Œéœ€è¦ `miniprogram-computed` åº“ä¸­å¯¼å…¥ `ComponentWithComputed` æ–¹æ³•

åœ¨ä½¿ç”¨æ—¶ï¼š**<font color="red">éœ€è¦å°† `Component` æ–¹æ³•æ›¿æ¢æˆ `ComponentWithComputed` æ–¹æ³• </font>**ï¼ŒåŸæœ¬ç»„ä»¶é…ç½®é¡¹ä¹Ÿéœ€è¦å†™åˆ°è¯¥æ–¹æ³•ä¸­



åœ¨æ›¿æ¢ä»¥åï¼Œå°±å¯ä»¥æ–°å¢ `computed` ä»¥åŠ `watch` é…ç½®é¡¹ã€‚



å®‰è£… `miniprogram-computed`ï¼Œ åœ¨å®‰è£…ä»¥åï¼Œéœ€è¦ç‚¹å‡» æ„å»º `npm`ï¼Œè¿›è¡Œæœ¬åœ°æ„å»º

```shell
npm install miniprogram-computed
```



>  ğŸ“Œ **æ³¨æ„äº‹é¡¹**ï¼š
>
>  â€‹	`computed` å‡½æ•°ä¸­ä¸èƒ½è®¿é—® this ï¼Œä½†æ˜¯æä¾›äº†å½¢å‚ï¼Œä»£è¡¨ `data` å¯¹è±¡
>
>  â€‹	è®¡ç®—å±æ€§å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è®¾ç½®åˆ° this.data.sum å­—æ®µä¸­



[å®˜æ–¹æ–‡æ¡£ï¼šminiprogram-computed](https://www.npmjs.com/package/miniprogram-computed)





**è½åœ°ä»£ç ï¼š**



`è®¡ç®—å±æ€§ computed` çš„ä½¿ç”¨



```js
// component.js

// å¼•å…¥ miniprogram-computed
import { ComponentWithComputed } from 'miniprogram-computed'

ComponentWithComputed({
  data: {
    a: 1,
    b: 1
  },
  
  computed: {
    total(data) {
      // æ³¨æ„ï¼š 
      // computed å‡½æ•°ä¸­ä¸èƒ½è®¿é—® this ï¼Œåªæœ‰ data å¯¹è±¡å¯ä¾›è®¿é—®
      // è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è®¾ç½®åˆ° this.data.sum å­—æ®µä¸­
        
      // è®¡ç®—å±æ€§å…·æœ‰ç¼“å­˜ï¼Œè®¡ç®—å±æ€§ä½¿ç”¨å¤šæ¬¡ï¼Œä½†æ˜¯è®¡ç®—å±æ€§æ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡
      console.log('~~~~~')
        
      return data.a + data.b
    }
  }
})

```







#### 2.2 ç›‘å¬å™¨ `watch`



åœ¨ä½¿ç”¨æ—¶ï¼š**<font color="red">éœ€è¦å°† `Component` æ–¹æ³•æ›¿æ¢æˆ `ComponentWithComputed` æ–¹æ³• </font>**ï¼ŒåŸæœ¬ç»„ä»¶é…ç½®é¡¹ä¹Ÿéœ€è¦å†™åˆ°è¯¥æ–¹æ³•ä¸­

åœ¨æ›¿æ¢ä»¥åï¼Œå°±å¯ä»¥æ–°å¢ `computed` ä»¥åŠ `watch` é…ç½®é¡¹ã€‚



```js
// å¼•å…¥ miniprogram-computed
import { ComponentWithComputed } from 'miniprogram-computed'

ComponentWithComputed({
    
  data: {
    a: 1,
    b: 1
  },
    
  computed: {
    total(data) {
      // æ³¨æ„ï¼š 
      // computed å‡½æ•°ä¸­ä¸èƒ½è®¿é—® this ï¼Œåªæœ‰ data å¯¹è±¡å¯ä¾›è®¿é—®
      // è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è®¾ç½®åˆ° this.data.sum å­—æ®µä¸­
      return data.a + data.b
    }
  }
  
  watch: {
    // åŒæ—¶å¯¹ a å’Œ b è¿›è¡Œç›‘å¬
    'a, b': function (a, b) {
      this.setData({
        total: a + b
      })
    }
  },
  
  methods: {
    updateData() {
      this.setData({
        a: this.data.a + 1,
        b: this.data.b + 1
      })
    }
  }
})


```









### æ‹“å±•ï¼šMobx ä¸ Computed ç»“åˆä½¿ç”¨



ä¸¤ä¸ªæ¡†æ¶æ‰©å±•æä¾›çš„ `ComponentWithStore` ä¸ `ComponentWithComputed` æ–¹æ³•æ— æ³•ç»“åˆä½¿ç”¨ã€‚

å¦‚æœéœ€è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­æ—¢æƒ³ä½¿ç”¨ `mobx-miniprogram-bindings` åˆæƒ³ä½¿ç”¨ `miniprogram-computed`



è§£å†³æ–¹æ¡ˆæ˜¯ï¼š



1. ä½¿ç”¨æ—§ç‰ˆ `API` 

   - è‡ªå®šä¹‰ç»„ä»¶ä»ç„¶ä½¿ç”¨ `Component` æ–¹æ³•æ„å»ºç»„ä»¶ï¼Œå°†ä¸¤ä¸ªæ‰©å±•ä¾èµ–åŒ…çš„ä½¿ç”¨å…¨éƒ¨æ”¹ä¸ºæ—§ç‰ˆ `API` 

   - [mobx-miniprogram-bindings å®˜æ–¹æ–‡æ¡£](https://www.npmjs.com/package/mobx-miniprogram-bindings)
   - [miniprogram-computed å®˜æ–¹æ–‡æ¡£](https://www.npmjs.com/package/miniprogram-computed)

   

2. ä½¿ç”¨å…¼å®¹å†™æ³•

   - å³è¦ä¹ˆä½¿ç”¨ `ComponentWithStore` æ–¹æ³•æ„å»ºç»„ä»¶ï¼Œè¦ä¹ˆä½¿ç”¨ `ComponentWithComputed` æ–¹æ³•æ„å»ºç»„ä»¶

   - å¦‚æœä½¿ç”¨äº† `ComponentWithStore` æ–¹æ³•æ„å»ºç»„ä»¶ï¼Œè®¡ç®—å±æ€§å†™æ³•ä½¿ç”¨æ—§ç‰ˆ `API` 
   - å¦‚æœä½¿ç”¨äº† `ComponentWithComputed` æ–¹æ³•æ„å»ºç»„ä»¶ï¼ŒMobxå†™æ³•ä½¿ç”¨æ—§ç‰ˆ `API` 



æˆ‘ä»¬æ¼”ç¤ºä½¿ç”¨å…¼å®¹å†™æ³•ï¼š



1. å¦‚æœä½¿ç”¨äº† `ComponentWithStore` æ–¹æ³•æ„å»ºç»„ä»¶ï¼Œè®¡ç®—å±æ€§å†™æ³•ä½¿ç”¨æ—§ç‰ˆ `API` 

   ```js
   import { ComponentWithComputed } from 'miniprogram-computed'
   
   // component.js
   const computedBehavior = require('miniprogram-computed').behavior
   
   ComponentWithStore({
     behaviors: [computedBehavior],
   
     data: {
       a: 1,
       b: 1,
       sum: 2
     },
       
     watch: {
       'a, b': function (a, b) {
         this.setData({
           total: a + b
         })
       }
     },
       
     computed: {
       total(data) {
         // æ³¨æ„ï¼š computed å‡½æ•°ä¸­ä¸èƒ½è®¿é—® this ï¼Œåªæœ‰ data å¯¹è±¡å¯ä¾›è®¿é—®
         // è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è®¾ç½®åˆ° this.data.sum å­—æ®µä¸­
         return data.a + data.b + data.sum // data.c ä¸ºè‡ªå®šä¹‰ behavior æ•°æ®æ®µ
       }
     },
       
     // å®ç°ç»„ä»¶å’Œ Store çš„å…³è”
     storeBindings: {
       store: numStore,
   
       // fields å’Œ actions æœ‰ä¸¤ç§å†™æ³•ï¼šæ•°ç»„å†™æ³• å’Œ å¯¹è±¡å†™æ³•
   
       // æ•°ç»„å†™æ³•
       fields: ['numA', 'numB', 'sum'],
       actions: ['update']
     }
   })
   ```

   

2. ä½¿ç”¨äº† `ComponentWithComputed` æ–¹æ³•æ„å»ºç»„ä»¶ï¼ŒMobxå†™æ³•ä½¿ç”¨æ—§ç‰ˆ `API` 

   ```js
   import { ComponentWithComputed } from 'miniprogram-computed'
   
   // å¯¼å…¥ storeBindingsBehavior æ–¹æ³•å®ç°ç»„ä»¶å’Œ Store çš„å…³è”
   import { storeBindingsBehavior } from "mobx-miniprogram-bindings"
   // å¯¼å…¥ Store 
   import { numStore } from '../../stores/numstore'
   
   
   ComponentWithComputed({
     behaviors: [storeBindingsBehavior],
   
     data: {
       a: 1,
       b: 1,
       sum: 2
     },
     watch: {
       'a, b': function (a, b) {
         this.setData({
           total: a + b
         })
       }
     },
     computed: {
       total(data) {
         // æ³¨æ„ï¼š computed å‡½æ•°ä¸­ä¸èƒ½è®¿é—® this ï¼Œåªæœ‰ data å¯¹è±¡å¯ä¾›è®¿é—®
         // è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è®¾ç½®åˆ° this.data.sum å­—æ®µä¸­
         return data.a + data.b + data.sum // data.c ä¸ºè‡ªå®šä¹‰ behavior æ•°æ®æ®µ
       }
     },
       
     // å®ç°ç»„ä»¶å’Œ Store çš„å…³è”
     storeBindings: {
       store: numStore,
   
       // fields å’Œ actions æœ‰ä¸¤ç§å†™æ³•ï¼šæ•°ç»„å†™æ³• å’Œ å¯¹è±¡å†™æ³•
   
       // æ•°ç»„å†™æ³•
       fields: ['numA', 'numB', 'sum'],
       actions: ['update']
     }
   })
   ```

   
















